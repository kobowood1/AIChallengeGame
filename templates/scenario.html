{% extends "base.html" %}

{% block title %}The CHALLENGE: Policy Jam - Mission Briefing{% endblock %}

{% block content %}
<div class="max-w-4xl mx-auto">
    <!-- Progress Bar -->
    <div class="mb-8">

        <h1 class="text-3xl font-bold mb-4 text-center text-gray-800">Republic of Bean: Education Reform Challenge</h1>
        <div class="w-full h-1 bg-gradient-to-r from-challenge-orange via-challenge-blue to-challenge-green mb-6"></div>

        
        <!-- Progress Bar -->
        <div class="mb-8">
            <div class="flex justify-between items-center mb-2">
                <span class="text-sm text-gray-600">Mission Briefing Progress</span>
                <span class="text-sm text-gray-600" id="progress-text">Step 1 of 4</span>
            </div>
            <div class="w-full bg-white border border-gray-300 rounded-full h-2">
                <div class="bg-gradient-to-r from-challenge-blue to-challenge-green h-2 rounded-full transition-all duration-500" id="progress-bar" style="width: 25%"></div>
            </div>
        </div>
    </div>
    <!-- Step Content Container -->
    <div id="step-content" class="min-h-screen">
        
        <!-- Step 1: Background Quest -->
        <div class="step-panel" id="step-1">
            <div class="bg-white p-6 rounded-lg shadow-lg mb-6 transform transition-all hover:shadow-xl border-l-4 border-challenge-blue">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-challenge-blue rounded-full flex items-center justify-center text-white mr-4 shadow-lg">
                        <i class="fas fa-book-open text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-challenge-blue">Background Quest</h2>
                    <div class="ml-auto px-2 py-1 bg-challenge-orange text-white rounded text-xs">
                        <i class="fas fa-trophy mr-1"></i> +5 XP
                    </div>
                </div>
                
                <div class="prose prose-gray max-w-none">
                    <p class="mb-3 leading-relaxed text-gray-700">Welcome to the Republic of Bean, a small democratic nation facing significant challenges after a period of economic and political stability. In recent years, Bean has experienced an influx of refugees from neighboring countries due to regional conflicts, creating unprecedented pressure on public servicesâ€”particularly the education system.</p>
                    
                    <p class="mb-3 leading-relaxed text-gray-700">As a member of parliament, you have been tasked with reforming Bean's education system to better address the needs of both citizens and refugees. The parliament has allocated a limited budget for these reforms, and you must work collaboratively with other representatives (AI-generated agents) to determine the most effective and equitable allocation of resources.</p>
                    
                    <p class="mb-0 leading-relaxed text-gray-700">Your decisions will impact generations of students, both native-born citizens and refugees. How will you balance competing interests, navigate political differences, and create a just and inclusive education system under budget constraints?</p>
                </div>
            </div>
        </div>

        <!-- Step 2: Mission Objectives -->
        <div class="step-panel hidden" id="step-2">
            <div class="bg-white p-6 rounded-lg shadow-lg mb-6 transform transition-all hover:shadow-xl border-l-4 border-challenge-green">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-challenge-green rounded-full flex items-center justify-center text-white mr-4 shadow-lg">
                        <i class="fas fa-tasks text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-challenge-green">Mission Objectives</h2>
                    <div class="ml-auto px-2 py-1 bg-challenge-green text-white rounded text-xs">
                        <i class="fas fa-medal mr-1"></i> 3 Challenges
                    </div>
                </div>
                
                <div class="prose prose-gray max-w-none">
                    <p class="mb-3 leading-relaxed text-gray-700">You will participate in a three-phase policy adventure:</p>
                    
                    <div class="space-y-4 ml-4">
                        <div class="flex items-start p-4 rounded-xl bg-blue-50 border border-blue-200 transform transition-all hover:shadow-md hover:translate-x-1">
                            <div class="bg-challenge-blue rounded-full w-8 h-8 flex items-center justify-center text-white mr-3 flex-shrink-0 shadow-md">1</div>
                            <div>
                                <h3 class="font-bold text-challenge-blue mb-1">Individual Policy Selection</h3>
                                <p class="text-gray-700 mb-0">Select one option from each of the five education policy areas within a 14-unit budget limit.</p>
                            </div>
                            <div class="ml-auto text-xs text-challenge-blue font-medium bg-blue-100 px-2 py-1 rounded">PHASE 1</div>
                        </div>
                        <div class="flex items-start p-4 rounded-xl bg-orange-50 border border-orange-200 transform transition-all hover:shadow-md hover:translate-x-1">
                            <div class="bg-challenge-orange rounded-full w-8 h-8 flex items-center justify-center text-white mr-3 flex-shrink-0 shadow-md">2</div>
                            <div>
                                <h3 class="font-bold text-challenge-orange mb-1">Collaborative Dialogue</h3>
                                <p class="text-gray-700 mb-0">Engage in discussion with four AI-generated citizen representatives who have different perspectives. Justify your choices and listen to their arguments.</p>
                            </div>
                            <div class="ml-auto text-xs text-challenge-orange font-medium bg-orange-100 px-2 py-1 rounded">PHASE 2</div>
                        </div>
                        <div class="flex items-start p-4 rounded-xl bg-purple-50 border border-purple-200 transform transition-all hover:shadow-md hover:translate-x-1">
                            <div class="bg-challenge-purple rounded-full w-8 h-8 flex items-center justify-center text-white mr-3 flex-shrink-0 shadow-md">3</div>
                            <div>
                                <h3 class="font-bold text-challenge-purple mb-1">Democratic Decision</h3>
                                <p class="text-gray-700 mb-0">Through majority voting, create a final education policy package that stays within budget.</p>
                            </div>
                            <div class="ml-auto text-xs text-challenge-purple font-medium bg-purple-100 px-2 py-1 rounded">PHASE 3</div>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-4 border border-amber-200 rounded-xl bg-amber-50">
                        <p class="text-gray-700 mb-0 flex items-center text-sm">
                            <i class="fas fa-lightbulb mr-2 text-amber-600"></i>
                            After the process concludes, you'll reflect on the experience, examining how power, values, and constraints shaped your decisions and the group's outcome.
                        </p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Step 3: Policy Challenges -->
        <div class="step-panel hidden" id="step-3">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6 transform transition-all hover:shadow-purple-500/20 hover:shadow-xl border-l-4 border-purple-500">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-purple-600 rounded-full flex items-center justify-center text-white mr-4 shadow-lg">
                        <i class="fas fa-brain text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-purple-400">Policy Challenges</h2>
                    <div class="ml-auto px-2 py-1 bg-purple-900/50 rounded text-xs text-purple-300">
                        <i class="fas fa-puzzle-piece mr-1"></i> 5 Areas
                    </div>
                </div>
                
                <div class="prose prose-invert">
                    <p class="mb-3 leading-relaxed !text-white">You will make decisions on these five critical education policy areas:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-4">
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:bg-gray-700/80">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-school text-blue-400 mr-2"></i>
                                <h3 class="font-bold text-blue-400 mb-0">Language Support</h3>
                            </div>
                            <p class="text-gray-300 mb-0 text-sm">How will refugee students overcome language barriers?</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:bg-gray-700/80">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-chalkboard-teacher text-green-400 mr-2"></i>
                                <h3 class="font-bold text-green-400 mb-0">Teacher Training</h3>
                            </div>
                            <p class="text-gray-300 mb-0 text-sm">How will educators be prepared to work with diverse students?</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:bg-gray-700/80">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-user-friends text-yellow-400 mr-2"></i>
                                <h3 class="font-bold text-yellow-400 mb-0">School Integration</h3>
                            </div>
                            <p class="text-gray-300 mb-0 text-sm">How will educational institutions accommodate refugee students?</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:bg-gray-700/80">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-heart text-red-400 mr-2"></i>
                                <h3 class="font-bold text-red-400 mb-0">Psychosocial Support</h3>
                            </div>
                            <p class="text-gray-300 mb-0 text-sm">What mental health resources should be provided?</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:bg-gray-700/80 md:col-span-2">
                            <div class="flex items-center mb-1">
                                <i class="fas fa-book text-purple-400 mr-2"></i>
                                <h3 class="font-bold text-purple-400 mb-0">Curriculum Adaptation</h3>
                            </div>
                            <p class="text-gray-300 mb-0 text-sm">How should content be modified to be inclusive and relevant?</p>
                        </div>
                    </div>
                    
                    <p class="mb-0 leading-relaxed !text-white">For each area, you'll choose from three options representing different approaches and resource investments.</p>
                </div>
            </div>
        </div>

        <!-- Step 4: Budget Constraints -->
        <div class="step-panel hidden" id="step-4">
            <div class="bg-gray-800 p-6 rounded-lg shadow-lg mb-6 transform transition-all hover:shadow-red-500/20 hover:shadow-xl border-l-4 border-red-500">
                <div class="flex items-center mb-4">
                    <div class="w-12 h-12 bg-red-600 rounded-full flex items-center justify-center text-white mr-4 shadow-lg">
                        <i class="fas fa-coins text-xl"></i>
                    </div>
                    <h2 class="text-xl font-bold text-red-400">Budget Constraints</h2>
                    <div class="ml-auto px-2 py-1 bg-red-900/50 rounded text-xs text-red-300">
                        <i class="fas fa-gem mr-1"></i> 14 Resource Units
                    </div>
                </div>
                
                <div class="prose prose-invert">
                    <p class="mb-3 leading-relaxed !text-white">The parliamentary budget committee has allocated <span class="text-yellow-400 font-bold">14 resource units</span> for education reform. Each policy option costs between 1-3 units, reflecting the relative investment required:</p>
                    
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-3 mb-4">
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:scale-105">
                            <div class="flex justify-center mb-2">
                                <div class="w-10 h-10 rounded-full bg-blue-900 border-2 border-blue-500 flex items-center justify-center text-white font-bold">1</div>
                            </div>
                            <h4 class="text-center font-bold text-blue-400 mb-1">Level 1</h4>
                            <div class="text-center text-yellow-400 font-bold text-lg mb-1">1 Unit</div>
                            <p class="text-center text-gray-300 text-sm mb-0">Basic implementation with minimal resources</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:scale-105">
                            <div class="flex justify-center mb-2">
                                <div class="w-10 h-10 rounded-full bg-purple-900 border-2 border-purple-500 flex items-center justify-center text-white font-bold">2</div>
                            </div>
                            <h4 class="text-center font-bold text-purple-400 mb-1">Level 2</h4>
                            <div class="text-center text-yellow-400 font-bold text-lg mb-1">2 Units</div>
                            <p class="text-center text-gray-300 text-sm mb-0">Moderate implementation with average resources</p>
                        </div>
                        <div class="p-3 rounded bg-gray-700/50 transform transition hover:scale-105">
                            <div class="flex justify-center mb-2">
                                <div class="w-10 h-10 rounded-full bg-red-900 border-2 border-red-500 flex items-center justify-center text-white font-bold">3</div>
                            </div>
                            <h4 class="text-center font-bold text-red-400 mb-1">Level 3</h4>
                            <div class="text-center text-yellow-400 font-bold text-lg mb-1">3 Units</div>
                            <p class="text-center text-gray-300 text-sm mb-0">Comprehensive implementation with significant resources</p>
                        </div>
                    </div>
                    
                    <div class="mt-4 p-3 border border-dashed border-red-500/50 rounded-lg bg-red-900/20">
                        <p class="text-red-300 mb-0 flex items-center text-sm">
                            <i class="fas fa-exclamation-triangle mr-2 text-red-400"></i>
                            You must carefully balance idealism with pragmatism. Your selections must not exceed the 14-unit limit.
                        </p>
                    </div>
                </div>
            </div>
            
            <!-- Final Call to Action (only on last step) -->
            <div class="text-center mb-8">
                <div class="relative inline-block group">
                    <div class="absolute -inset-1 bg-gradient-to-r from-blue-500 to-purple-500 rounded-lg blur opacity-50 group-hover:opacity-100 transition duration-200"></div>
                    <a href="{{ url_for('main.phase1') }}" class="relative bg-gradient-to-r from-blue-600 to-blue-700 hover:from-blue-700 hover:to-blue-800 text-white font-bold py-3 px-10 rounded-lg text-lg transition transform hover:scale-105 inline-flex items-center shadow-lg">
                        <i class="fas fa-play-circle mr-2"></i>Begin Your Policy Adventure
                    </a>
                </div>
                <div class="mt-3 text-xs text-white">
                    Estimated completion time: 30 minutes
                </div>
            </div>
        </div>
    </div>

    <!-- Navigation Controls -->
    <div class="fixed bottom-6 left-1/2 transform -translate-x-1/2 bg-gray-800 rounded-full px-6 py-3 shadow-lg border border-gray-600">
        <div class="flex items-center space-x-4">
            <button id="prev-btn" onclick="previousStep()" class="px-4 py-2 bg-gray-600 hover:bg-gray-500 text-white rounded-lg transition disabled:opacity-50 disabled:cursor-not-allowed" disabled>
                <i class="fas fa-chevron-left mr-2"></i>Previous
            </button>
            <div class="flex space-x-2">
                <div class="w-2 h-2 rounded-full bg-blue-500 step-dot" data-step="1"></div>
                <div class="w-2 h-2 rounded-full bg-gray-500 step-dot" data-step="2"></div>
                <div class="w-2 h-2 rounded-full bg-gray-500 step-dot" data-step="3"></div>
                <div class="w-2 h-2 rounded-full bg-gray-500 step-dot" data-step="4"></div>
            </div>
            <button id="next-btn" onclick="nextStep()" class="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg transition">
                Next<i class="fas fa-chevron-right ml-2"></i>
            </button>
        </div>
    </div>
</div>

<script>
let currentStep = 1;
const totalSteps = 4;

function updateProgress() {
    const progressBar = document.getElementById('progress-bar');
    const progressText = document.getElementById('progress-text');
    const prevBtn = document.getElementById('prev-btn');
    const nextBtn = document.getElementById('next-btn');
    
    // Update progress bar
    const progressPercentage = (currentStep / totalSteps) * 100;
    progressBar.style.width = progressPercentage + '%';
    
    // Update progress text
    progressText.textContent = `Step ${currentStep} of ${totalSteps}`;
    
    // Update navigation buttons
    prevBtn.disabled = currentStep === 1;
    if (currentStep === totalSteps) {
        nextBtn.style.display = 'none';
    } else {
        nextBtn.style.display = 'inline-flex';
    }
    
    // Update step dots
    document.querySelectorAll('.step-dot').forEach((dot, index) => {
        if (index + 1 <= currentStep) {
            dot.classList.remove('bg-gray-500');
            dot.classList.add('bg-blue-500');
        } else {
            dot.classList.remove('bg-blue-500');
            dot.classList.add('bg-gray-500');
        }
    });
}

function showStep(stepNumber) {
    // Hide all steps
    document.querySelectorAll('.step-panel').forEach(panel => {
        panel.classList.add('hidden');
    });
    
    // Show current step
    document.getElementById(`step-${stepNumber}`).classList.remove('hidden');
    
    // Scroll to top
    window.scrollTo({ top: 0, behavior: 'smooth' });
}

function nextStep() {
    if (currentStep < totalSteps) {
        currentStep++;
        showStep(currentStep);
        updateProgress();
    }
}

function previousStep() {
    if (currentStep > 1) {
        currentStep--;
        showStep(currentStep);
        updateProgress();
    }
}

// Add keyboard navigation
document.addEventListener('keydown', function(event) {
    if (event.key === 'ArrowLeft' && currentStep > 1) {
        previousStep();
    } else if (event.key === 'ArrowRight' && currentStep < totalSteps) {
        nextStep();
    }
});

// Initialize
document.addEventListener('DOMContentLoaded', function() {
    updateProgress();
});
</script>

<style>
.text-gradient {
    background-clip: text;
    -webkit-background-clip: text;
    color: transparent;
}

.step-panel {
    animation: fadeIn 0.5s ease-in-out;
}

@keyframes fadeIn {
    from {
        opacity: 0;
        transform: translateY(20px);
    }
    to {
        opacity: 1;
        transform: translateY(0);
    }
}

.step-dot {
    transition: all 0.3s ease;
}

.step-dot:hover {
    transform: scale(1.2);
}
</style>
{% endblock %}